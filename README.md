# Проект "Распознавание результатов анализов"

Куратор - Бондаренко Денис

Участники: Басова Юлия, Вишнякова Алиса, Жильцова Марина

Задачи проекта:

1. Предобработка изображений: Нормализация изображений: изменение яркости, контраста,
устранение шумов.

2. Распознавание текста (+ выравнивание)
- Использование OCR для извлечения текста с изображений (пример либы: Tesseract)
- Постобработка текста: исправление ошибок OCR, удаление лишних символов, разделение текста
на строки и столбцы.

3. Извлечение данных:

Анализ текста для выделения ключевых элементов:
- Название показателя (например, "Глюкоза", "Холестерин").
- Значение показателя (например, "5.2", "120").
- Единица измерения (например, "ммоль/л", "мг/дл").
- Дата сдачи анализа
- Название клиники

4. Доработки:
- Учет вариативности в наименованиях показателей
- Разнообразие единиц измерения (Один и тот же показатель может быть выражен в различных
единицах измерения, что требует дополнительной обработки для приведения данных к единому
стандарту)
- Результаты анализов могут быть представлены в рукописном виде или в форматах, которые не
соответствуют стандартной структуре


# Объяснение работы кода

## main.py
Конвертация изображений: Код сначала конвертирует все изображения из указанной директории в формат PNG, чтобы обеспечить совместимость для дальнейшей обработки.
Извлечение текста: Затем он обрабатывает каждое изображение, извлекая текст с помощью двух функций: одна для обычного извлечения текста, другая — для работы с изображениями, содержащими шум.
Фильтрация текста: Извлеченные тексты проходят фильтрацию для удаления нежелательных символов или форматирования. Вывод результатов.

```
image_path = r'C:\\Project ML\\test main\\image'  
output_directory = r'C:\\Project ML\\test main\\img_png' 


convert_to_png(image_path, output_directory)

# Обработка изображений в выходной директории
for image in os.listdir(output_directory):
    # Формируем полный путь к изображению
    image_full_path = os.path.join(output_directory, image)
    
    # Проверяем, что файл является изображением
    if image.lower().endswith(('.png', '.jpg', '.jpeg', '.bmp')):
        result_text = get_text(image_full_path)  # обработка изображения
        result_text_with_shum = get_text_with_shum(image_full_path)  # обработка изображения с шумом

        print(result_text)
        print(filter_text(result_text))
        print('\n')
        print(result_text_with_shum)
        print(filter_text(result_text_with_shum))
```

## tesseract_test.py
Файл с объединением функций pytesseract и функций предобработки изображения в функции get_text и get_text_with_shum.

## preprocess_of_image.py
Файл, содержащий в себе функции, отвечающие за предобработку изображений.
### get_parametres(img)
С помощью функций из библиотеки numpy извлекает и возвращает среднее значение и стандартное отклонение яркости изображения img 
### adaptive_bilateral_filter(image)
Применяет bilateralFilter библиотеки OpenCV для избавления от шума на изображении, индивидуально вычисляя лучшие параметры для фильтра
### process_image(image_path,output_path)
Обрабатывает изображение по заданному пути, определяя необходимость коррекции яркости и контрастности с помощью функции needs_processing. Если требуется обработка, функция корректирует яркость и контрастность( нормализуя значения пикселей с использованием максимального значения) изображения, применяет адаптивный билинейный фильтр и сохраняет результат, иначе сохраняет оригинальное изображение без изменений.
### process_image_with_shum(image_path,output_path)
Обрабатывает изображение по заданному пути, определяя необходимость коррекции яркости и контрастности с помощью функции needs_processing. Если требуется обработка, функция корректирует яркость и контрастность( нормализуя значения пикселей с использованием максимального значения) изображения, без применения адаптивного билинейного фильтра и сохраняет результат, иначе сохраняет оригинальное изображение без изменений.
### needs_processing(image_path)
Анализирует изображение, вычисляя среднее значение яркости и стандартное отклонение, чтобы определить, нужна ли коррекция яркости. Она также создает гистограмму значений пикселей, чтобы проверить необходимость обработки контрастности, возвращая флаги для яркости и контрастности.
### display_images(original, processed, without_shum)
Отображает три изображения в одном окне с помощью библиотеки Matplotlib: оригинальное изображение, обработанное изображение с шумом и обработанное изображение без шума
## ustranenie_in_text.py
Содержит функцию filter_text, в которой, используя библиотеки nltk и re для работы с текстом, переданный в функцию текст фильтруется от лишних символов и слов. Возвращает строку с обработанным текстом.
## converter_pdf.py
### convert_to_png(input_dir,output_dir)
Проходит по всем файлам в input_dir, конвертирует PDF-файлы в изображения PNG (по одной странице на файл) и преобразует изображения форматов JPG, JPEG и BMP в PNG, сохраняя их в указанной выходной директории, при этом игнорируя неподдерживаемые форматы.
